FROM python:3.7 as frmPYTHON

RUN apt-get update
RUN apt-get install -y --no-install-recommends wget apt-transport-https
RUN apt-get update \
 && apt-get clean\
 && apt-get install -y --no-install-recommends libc6-dev libgdiplus wget software-properties-common
RUN apt-get update -y vim

RUN pip3.7 install --upgrade pip

COPY ./python_path /app2
ADD ./Cert/CA.crt /dockerpath/CA.crt
ADD ./Cerrt/client.pem /dockerpath/client.pem
RUN update-ca-certificates

WORKDIR /app2

RUN pip3.7 install -r /app2/requirements.txt

FROM mcr.microsoft.com/dotnet/core/aspnet:3.1
COPY ./ws_path /app
ADD ./Cert/CA.crt /dockerpath/CA.crt
ADD ./Cert/client.pfx /dockerpath/client.pfx
ADD ./Cert/client.pem /dockerpath/client.pem
RUN update-ca-certificates

WORKDIR /app
EXPOSE 80/TCP
COPY --from==frmPYTHON / /
ENTRYPOINT ["dotnet","root.dll"]